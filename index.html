<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Locate.min.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <!--<link rel="stylesheet" href="css/leaflet-control-geocoder.Geocoder.css">-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

    <link rel="stylesheet" href="css/leaflet-measure.css">
    <link rel="stylesheet" href="css/leaflet-geoman.css" />
    <link rel="stylesheet" href="css/Leaflet.Coordinates-0.1.3.css" />
    <link rel="stylesheet" href="css/Leaflet.StyleEditor.min.css" />


    <style>
        html,
        body,
        #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }

        #export {
            position: absolute;
            top: 500px;
            left: 10px;
            padding: 2px;
            z-index: 500;
        }

        #import {
            position: absolute;
            top: 470px;
            left: 10px;
            padding: 2px;
            z-index: 500;
        }
    </style>
    <title>EPEx</title>
</head>

<body>

    <div id="map"></div>
    <button id="export">ExportGeoJson</button>
    <input type=file id="import" accept=".geojson" value="ImportGeoJson" />
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/L.Control.Locate.min.js"></script>
    <script src="js/leaflet-svg-shape-markers.min.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <!--<script src="js/leaflet-control-geocoder.Geocoder.js"></script>-->
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="js/leaflet-measure.js"></script>

    <script src="https://unpkg.com/sql.js@0.3.2/js/sql.js"></script>
    <script src="https://unpkg.com/Leaflet.TileLayer.MBTiles@1.0.0/Leaflet.TileLayer.MBTiles.js"></script>


    <script src="js/leaflet.latlng-graticule.js"></script>
    <script type="text/javascript" src="js/Leaflet.Coordinates-0.1.3.min.js"></script>
    <script src="js/leaflet.browser.print.min.js"></script>
    <script src="js/Leaflet.StyleEditor.min.js"></script>
    <script src="data/Transitabilidade_Blindados_0.js"></script>
    <script src="data/Poligono_Tiro_1.js"></script>
    <script src="data/Vegetacao_2.js"></script>
    <script src="data/Estrada_Mussurepe_3.js"></script>
    <script src="data/Area_Selecionada_ESE_4.js"></script>
    <script src="data/Area_RecargaTopo_Morro_5.js"></script>
    <script src="data/Area_Edificada_6.js"></script>
    <script src="data/Area_Dest_Com_Conv_7.js"></script>
    <script src="data/area_CIMNC_8.js"></script>
    <script src="data/area_APA_9.js"></script>    

    <script src="js/leaflet-geoman.min.js"></script>
    <script src="https://unpkg.com/esri-leaflet@2.1.3/dist/esri-leaflet.js"
        integrity="sha512-pijLQd2FbV/7+Jwa86Mk3ACxnasfIMzJRrIlVQsuPKPCfUBCDMDUoLiBQRg7dAQY6D1rkmCcR8286hVTn/wlIg=="
        crossorigin=""></script>

    <script>
        var map = L.map('map', {
            zoomControl: true, maxZoom: 19, minZoom: 1, drawControl: true, center: [-7.87, -35.77], zoom: 9,
        })
        /*}).fitBounds([[-21.53881958301445, -58.148592817470416], [-19.815427888219396, -54.63288875256847]]);
        }).setView([-20.241,-56.382],9);*/
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({ truncate: { length: 30, location: 'smart' } });
        L.control.locate({ locateOptions: { maxZoom: 19 } }).addTo(map);
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0]
            .innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0]
            .className += ' fas fa-ruler';
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
            map.setMaxBounds(map.getBounds());
        }



        //data -------------------------------------------------------------

        function pop_Transitabilidade_Blindados_0(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">area(ha)</th>\
                        <td>' + (feature.properties['area(ha)'] !== null ? autolinker.link(feature.properties['area(ha)'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, { maxHeight: 400 });
        }

        function style_Transitabilidade_Blindados_0_0() {
            return {
                pane: 'pane_Transitabilidade_Blindados_0',
                opacity: 1,
                color: 'rgba(0,0,0,0.4)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(227,52,55,0.4)',
                interactive: true,
            }
        }
        map.createPane('pane_Transitabilidade_Blindados_0');
        map.getPane('pane_Transitabilidade_Blindados_0').style.zIndex = 409;
        map.getPane('pane_Transitabilidade_Blindados_0').style['mix-blend-mode'] = 'normal';
        var layer_Transitabilidade_Blindados_0 = new L.geoJson(json_Transitabilidade_Blindados_0, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Transitabilidade_Blindados_0',
            layerName: 'layer_Transitabilidade_Blindados_0',
            pane: 'pane_Transitabilidade_Blindados_0',
            onEachFeature: pop_Transitabilidade_Blindados_0,
            style: style_Transitabilidade_Blindados_0_0,
        });
        bounds_group.addLayer(layer_Transitabilidade_Blindados_0);
        function pop_Poligono_Tiro_1(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">nome</th>\
                        <td>' + (feature.properties['nome'] !== null ? autolinker.link(feature.properties['nome'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">area(ha)</th>\
                        <td>' + (feature.properties['area(ha)'] !== null ? autolinker.link(feature.properties['area(ha)'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, { maxHeight: 400 });
        }

        function style_Poligono_Tiro_1_0() {
            return {
                pane: 'pane_Poligono_Tiro_1',
                opacity: 1,
                color: 'rgba(35,35,35,0.4)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(227,26,28,0.4)',
                interactive: true,
            }
        }
        map.createPane('pane_Poligono_Tiro_1');
        map.getPane('pane_Poligono_Tiro_1').style.zIndex = 408;
        map.getPane('pane_Poligono_Tiro_1').style['mix-blend-mode'] = 'normal';
        var layer_Poligono_Tiro_1 = new L.geoJson(json_Poligono_Tiro_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Poligono_Tiro_1',
            layerName: 'layer_Poligono_Tiro_1',
            pane: 'pane_Poligono_Tiro_1',
            onEachFeature: pop_Poligono_Tiro_1,
            style: style_Poligono_Tiro_1_0,
        });
        bounds_group.addLayer(layer_Poligono_Tiro_1);
        function pop_Vegetacao_2(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">nome</th>\
                        <td>' + (feature.properties['nome'] !== null ? autolinker.link(feature.properties['nome'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">area(ha)</th>\
                        <td>' + (feature.properties['area(ha)'] !== null ? autolinker.link(feature.properties['area(ha)'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, { maxHeight: 400 });
        }

        function style_Vegetacao_2_0() {
            return {
                pane: 'pane_Vegetacao_2',
                stroke: false,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(148,209,128,0.4)',
                interactive: true,
            }
        }
        map.createPane('pane_Vegetacao_2');
        map.getPane('pane_Vegetacao_2').style.zIndex = 403;
        map.getPane('pane_Vegetacao_2').style['mix-blend-mode'] = 'normal';
        var layer_Vegetacao_2 = new L.geoJson(json_Vegetacao_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Vegetacao_2',
            layerName: 'layer_Vegetacao_2',
            pane: 'pane_Vegetacao_2',
            onEachFeature: pop_Vegetacao_2,
            style: style_Vegetacao_2_0,
        });
        bounds_group.addLayer(layer_Vegetacao_2);
        function pop_Estrada_Mussurepe_3(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">nome</th>\
                        <td>' + (feature.properties['nome'] !== null ? autolinker.link(feature.properties['nome'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, { maxHeight: 400 });
        }

        function style_Estrada_Mussurepe_3_0() {
            return {
                pane: 'pane_Estrada_Mussurepe_3',
                opacity: 1,
                color: 'rgba(0,0,0,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 3.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        map.createPane('pane_Estrada_Mussurepe_3');
        map.getPane('pane_Estrada_Mussurepe_3').style.zIndex = 406;
        map.getPane('pane_Estrada_Mussurepe_3').style['mix-blend-mode'] = 'normal';
        var layer_Estrada_Mussurepe_3 = new L.geoJson(json_Estrada_Mussurepe_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Estrada_Mussurepe_3',
            layerName: 'layer_Estrada_Mussurepe_3',
            pane: 'pane_Estrada_Mussurepe_3',
            onEachFeature: pop_Estrada_Mussurepe_3,
            style: style_Estrada_Mussurepe_3_0,
        });
        bounds_group.addLayer(layer_Estrada_Mussurepe_3);
        function pop_Area_Selecionada_ESE_4(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">area(ha)</th>\
                        <td>' + (feature.properties['area(ha)'] !== null ? autolinker.link(feature.properties['area(ha)'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, { maxHeight: 400 });
        }

        function style_Area_Selecionada_ESE_4_0() {
            return {
                pane: 'pane_Area_Selecionada_ESE_4',
                opacity: 1,
                color: 'rgba(35,35,35,0.4)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(152,125,183,0.4)',
                interactive: true,
            }
        }
        map.createPane('pane_Area_Selecionada_ESE_4');
        map.getPane('pane_Area_Selecionada_ESE_4').style.zIndex = 405;
        map.getPane('pane_Area_Selecionada_ESE_4').style['mix-blend-mode'] = 'normal';
        var layer_Area_Selecionada_ESE_4 = new L.geoJson(json_Area_Selecionada_ESE_4, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Area_Selecionada_ESE_4',
            layerName: 'layer_Area_Selecionada_ESE_4',
            pane: 'pane_Area_Selecionada_ESE_4',
            onEachFeature: pop_Area_Selecionada_ESE_4,
            style: style_Area_Selecionada_ESE_4_0,
        });
        bounds_group.addLayer(layer_Area_Selecionada_ESE_4);
        function pop_Area_RecargaTopo_Morro_5(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">area(ha)</th>\
                        <td>' + (feature.properties['area(ha)'] !== null ? autolinker.link(feature.properties['area(ha)'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, { maxHeight: 400 });
        }

        function style_Area_RecargaTopo_Morro_5_0() {
            return {
                pane: 'pane_Area_RecargaTopo_Morro_5',
                opacity: 1,
                color: 'rgba(35,35,35,0.4)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,127,0,0.4)',
                interactive: true,
            }
        }
        map.createPane('pane_Area_RecargaTopo_Morro_5');
        map.getPane('pane_Area_RecargaTopo_Morro_5').style.zIndex = 404;
        map.getPane('pane_Area_RecargaTopo_Morro_5').style['mix-blend-mode'] = 'normal';
        var layer_Area_RecargaTopo_Morro_5 = new L.geoJson(json_Area_RecargaTopo_Morro_5, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Area_RecargaTopo_Morro_5',
            layerName: 'layer_Area_RecargaTopo_Morro_5',
            pane: 'pane_Area_RecargaTopo_Morro_5',
            onEachFeature: pop_Area_RecargaTopo_Morro_5,
            style: style_Area_RecargaTopo_Morro_5_0,
        });
        bounds_group.addLayer(layer_Area_RecargaTopo_Morro_5);
        function pop_Area_Edificada_6(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Edificação</th>\
                        <td>' + (feature.properties['Edificação'] !== null ? autolinker.link(feature.properties['Edificação'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">area(ha)</th>\
                        <td>' + (feature.properties['area(ha)'] !== null ? autolinker.link(feature.properties['area(ha)'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, { maxHeight: 400 });
        }

        function style_Area_Edificada_6_0() {
            return {
                pane: 'pane_Area_Edificada_6',
                opacity: 1,
                color: 'rgba(35,35,35,0.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(251,154,153,0.4)',
                interactive: true,
            }
        }
        map.createPane('pane_Area_Edificada_6');
        map.getPane('pane_Area_Edificada_6').style.zIndex = 407;
        map.getPane('pane_Area_Edificada_6').style['mix-blend-mode'] = 'normal';
        var layer_Area_Edificada_6 = new L.geoJson(json_Area_Edificada_6, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Area_Edificada_6',
            layerName: 'layer_Area_Edificada_6',
            pane: 'pane_Area_Edificada_6',
            onEachFeature: pop_Area_Edificada_6,
            style: style_Area_Edificada_6_0,
        });
        bounds_group.addLayer(layer_Area_Edificada_6);
        function pop_Area_Dest_Com_Conv_7(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">area(ha)</th>\
                        <td>' + (feature.properties['area(ha)'] !== null ? autolinker.link(feature.properties['area(ha)'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, { maxHeight: 400 });
        }

        function style_Area_Dest_Com_Conv_7_0() {
            return {
                pane: 'pane_Area_Dest_Com_Conv_7',
                opacity: 1,
                color: 'rgba(35,35,35,0.4)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(166,206,227,0.4)',
                interactive: true,
            }
        }
        map.createPane('pane_Area_Dest_Com_Conv_7');
        map.getPane('pane_Area_Dest_Com_Conv_7').style.zIndex = 402;
        map.getPane('pane_Area_Dest_Com_Conv_7').style['mix-blend-mode'] = 'normal';
        var layer_Area_Dest_Com_Conv_7 = new L.geoJson(json_Area_Dest_Com_Conv_7, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Area_Dest_Com_Conv_7',
            layerName: 'layer_Area_Dest_Com_Conv_7',
            pane: 'pane_Area_Dest_Com_Conv_7',
            onEachFeature: pop_Area_Dest_Com_Conv_7,
            style: style_Area_Dest_Com_Conv_7_0,
        });
        bounds_group.addLayer(layer_Area_Dest_Com_Conv_7);
        function pop_area_CIMNC_8(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">NOCAD</th>\
                        <td>' + (feature.properties['NOCAD'] !== null ? autolinker.link(feature.properties['NOCAD'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">area(ha)</th>\
                        <td>' + (feature.properties['area(ha)'] !== null ? autolinker.link(feature.properties['area(ha)'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, { maxHeight: 400 });
        }

        function style_area_CIMNC_8_0() {
            return {
                pane: 'pane_area_CIMNC_8',
                opacity: 1,
                color: 'rgba(227,26,28,1.0)',
                dashArray: '10,5',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        map.createPane('pane_area_CIMNC_8');
        map.getPane('pane_area_CIMNC_8').style.zIndex = 401;
        map.getPane('pane_area_CIMNC_8').style['mix-blend-mode'] = 'normal';
        var layer_area_CIMNC_8 = new L.geoJson(json_area_CIMNC_8, {
            attribution: '',
            interactive: true,
            dataVar: 'json_area_CIMNC_8',
            layerName: 'layer_area_CIMNC_8',
            pane: 'pane_area_CIMNC_8',
            onEachFeature: pop_area_CIMNC_8,
            style: style_area_CIMNC_8_0,
        });
        bounds_group.addLayer(layer_area_CIMNC_8);
        function pop_area_APA_9(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">zona</th>\
                        <td>' + (feature.properties['zona'] !== null ? autolinker.link(feature.properties['zona'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">subzona</th>\
                        <td>' + (feature.properties['subzona'] !== null ? autolinker.link(feature.properties['subzona'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">area(ha)</th>\
                        <td>' + (feature.properties['area(ha)'] !== null ? autolinker.link(feature.properties['area(ha)'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, { maxHeight: 400 });
        }

        function style_area_APA_9_0() {
            return {
                pane: 'pane_area_APA_9',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '10,5',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        map.createPane('pane_area_APA_9');
        map.getPane('pane_area_APA_9').style.zIndex = 400;
        map.getPane('pane_area_APA_9').style['mix-blend-mode'] = 'normal';
        var layer_area_APA_9 = new L.geoJson(json_area_APA_9, {
            attribution: '',
            interactive: true,
            dataVar: 'json_area_APA_9',
            layerName: 'layer_area_APA_9',
            pane: 'pane_area_APA_9',
            onEachFeature: pop_area_APA_9,
            style: style_area_APA_9_0,
        });
        bounds_group.addLayer(layer_area_APA_9);


        // basemaps layers -------------------------------------------------------------
        var bdgex_url = "https://bdgex.eb.mil.br/mapcache"
        var wmsLayer = L.tileLayer.wms(bdgex_url, {
            layers: 'ctmmultiescalas_mercator',
            //})
        }).addTo(map);

        var ex = L.tileLayer.wms("https://bdgex.eb.mil.br/mapcache3857", {
            layers: ['estados', 'capitais'],
            format: 'image/png',
        }).addTo(map);

        var rapideye = L.tileLayer.wms("https://bdgex.eb.mil.br/mapcache3857", {
            layers: 'rapideye',
            format: 'image/png',
        });

        var cbers = L.tileLayer.wms("https://brazildatacube.dpi.inpe.br/bdc/geoserver/mosaics/ows", {
            layers: 'mosaics:CB4-MOSAIC-BRAZIL_64_3M_STK',
            errorTileUrl: 'error',
        });

        var imgs = L.tileLayer('data/1.RASTERS/imagens/{z}/{x}/{y}.png', {
            minZoom: 1,
            maxZoom: 19,
            tms: true,

        });

        var srtm = L.tileLayer('data/1.RASTERS/srtm/{z}/{x}/{y}.png', {
            minZoom: 1,
            maxZoom: 19,
            tms: true,

        });

        var carta = L.tileLayer('data/1.RASTERS/carta/{z}/{x}/{y}.png', {
            minZoom: 1,
            maxZoom: 19,
            tms: true,

        });

        var buff = L.tileLayer('data/1.RASTERS/buffer_100m/{z}/{x}/{y}.png', {
            minZoom: 1,
            maxZoom: 19,
            tms: true,

        });

        var drenag = L.tileLayer('data/1.RASTERS/drenagem/{z}/{x}/{y}.png', {
            minZoom: 1,
            maxZoom: 19,
            tms: true,

        });

        var trecho_rod = L.tileLayer('data/1.RASTERS/rodovias/{z}/{x}/{y}.png', {
            minZoom: 1,
            maxZoom: 19,
            tms: true,

        });

        var area_trans = L.tileLayer('data/1.RASTERS/area_trans/{z}/{x}/{y}.png', {
            minZoom: 1,
            maxZoom: 19,
            tms: true,

        });


        var baseMaps = {
            "Blank": L.tileLayer(''),
            "cbers_2023": cbers,
            "rapideye_2012": rapideye,
            "imagens": imgs,
            "srtm": srtm,
            "carta_esp": carta,

        };

        L.control.layers(baseMaps, {

            '<img src=""/> Buffer_100m': buff,
            '<img src=""/> Drenagem': drenag,
            '<img src=""/> Trecho_Rod': trecho_rod,
            '<img src="legend/area_APA_9.png" /> area_APA': layer_area_APA_9,
            '<img src="legend/area_CIMNC_8.png" /> area_CIMNC': layer_area_CIMNC_8,
            '<img src="legend/Area_Dest_Com_Conv_7.png" /> Area_Dest_Com_Conv': layer_Area_Dest_Com_Conv_7,
            '<img src="legend/Area_Edificada_6.png" /> Area_Edificada': layer_Area_Edificada_6,
            '<img src="legend/Area_RecargaTopo_Morro_5.png" /> Area_Recarga-Topo_Morro': layer_Area_RecargaTopo_Morro_5,
            '<img src="legend/Area_Selecionada_ESE_4.png" /> Area_Selecionada_ESE': layer_Area_Selecionada_ESE_4,
            '<img src="legend/Estrada_Mussurepe_3.png" /> Estrada_Mussurepe': layer_Estrada_Mussurepe_3,
            '<img src="legend/Vegetacao_2.png" /> Vegetacao': layer_Vegetacao_2,
            '<img src="legend/Poligono_Tiro_1.png" /> Poligono_Tiro': layer_Poligono_Tiro_1,
            '<img src="legend/Transitabilidade_Blindados_0.png" /> Transitabilidade_Blindados': layer_Transitabilidade_Blindados_0,

        }).addTo(map);



        //abstract -------------------------------------------------------------
        /*var abstract = new L.Control({ 'position': 'bottomright' });
        abstract.onAdd = function (map) {
            this._div = L.DomUtil.create('div',
                'leaflet-control abstract');
            this._div.id = 'abstract'

            abstract.show();
            return this._div;
        };
        abstract.show = function () {
            this._div.classList.remove("abstract");
            this._div.classList.add("abstractUncollapsed");
            this._div.innerHTML = 'visualização de estruturas de relevância no terreno para planejamento operações logística.';
        };
        abstract.addTo(map);*/

        //plugin geocoder -------------------------------------------------------------
        var osmGeocoder = new L.Control.Geocoder({
            collapsed: true,
            position: 'topleft',
            text: 'Search',
            title: 'Testing'
        }).addTo(map);
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
            .className += ' fa fa-search';
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
            .title += 'Search for a place';


        // texto nos layers -------------------------------------------------------------
        //setBounds();
        /*
        var i = 0;
        layer_GISSDEESTADO_DE_MS_POLITICO_0.eachLayer(function (layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Municipio'] !== null ? String('<div style="color: #fbfcfc ; font-size: 12pt; font-family: \'Liberation Sans\', sans-serif;">' + layer.feature.properties['Municipio']) + '</div>' : ''), { permanent: true, offset: [-0, -16], className: 'css_GISSDEESTADO_DE_MS_POLITICO_0' });
            labels.push(layer);
            totalMarkers += 1;
            layer.added = true;
            addLabel(layer, i);
            i++;
        });

        var i = 0;
        layer_GISSDEESTADO_DE_MS_POLITICO_1.eachLayer(function (layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['NM_MUN'] !== null ? String('<div style="color: #fbfcfc ; font-size: 12pt; font-family: \'Liberation Sans\', sans-serif;">' + layer.feature.properties['NM_MUN']) + '</div>' : ''), { permanent: true, offset: [-0, -16], className: 'css_GISSDEESTADO_DE_MS_POLITICO_1' });
            labels.push(layer);
            totalMarkers += 1;
            layer.added = true;
            addLabel(layer, i);
            i++;
        });

        resetLabels([layer_GISSDEESTADO_DE_MS_POLITICO_0, layer_GISSDEESTADO_DE_MS_POLITICO_1]);
        map.on("zoomend", function () {
            resetLabels([layer_GISSDEESTADO_DE_MS_POLITICO_0, layer_GISSDEESTADO_DE_MS_POLITICO_1]);
        });
        map.on("layeradd", function () {
            resetLabels([layer_GISSDEESTADO_DE_MS_POLITICO_0, layer_GISSDEESTADO_DE_MS_POLITICO_1]);
        });
        map.on("layerremove", function () {
            resetLabels([layer_GISSDEESTADO_DE_MS_POLITICO_0, layer_GISSDEESTADO_DE_MS_POLITICO_1]);
        });*/



        L.control.scale({
            metric: true,
            imperial: false,
            maxWidth: 100,
            position: "bottomleft"

        }).addTo(map);

        L.control.coordinates({
            position: "bottomleft", //optional default "bootomright"
            decimals: 4, //optional default 4
            decimalSeperator: ".", //optional default "."
            labelTemplateLat: "Latitude: {y}", //optional default "Lat: {y}"
            labelTemplateLng: "Longitude: {x}", //optional default "Lng: {x}"
            enableUserInput: true, //optional default true
            useDMS: false, //optional default false
            useLatLngOrder: true, //ordering of labels, default false-> lng-lat
            markerType: L.marker, //optional default L.marker
            markerProps: {}, //optional default {},
            labelFormatterLng: function (lng) { return lng + " lng" }, //optional default none,
            labelFormatterLat: function (lat) { return lat + " lat" }, //optional default none
            customLabelFcn: function (latLonObj, opts) { "Geohash: " + encodeGeoHash(latLonObj.lat, latLonObj.lng) } //optional default none
        }).addTo(map);

        L.latlngGraticule({
            showLabel: true,
            dashArray: [5, 5],
            zoomInterval: [
                { start: 2, end: 3, interval: 30 },
                { start: 4, end: 4, interval: 10 },
                { start: 5, end: 7, interval: 5 },
                { start: 8, end: 10, interval: 1 },
                { start: 11, end: 16, interval: 0.25 }
            ]
        }).addTo(map);

        map.pm.addControls({
            position: 'topright',
            drawMarker: true,
            drawCircleMarker: true,
            rotateMode: true,
            oneBlock: false,
        });


        function generateGeoJson() {
            var fg = L.featureGroup();
            var layers = findLayers(map);
            //var layers = groupDraw.getLayers();
            //debugger;
            var geo = {
                type: "FeatureCollection",
                features: [],
            };
            //debugger;
            layers.forEach(function (layer) {
                var geoJson = JSON.parse(JSON.stringify(layer.toGeoJSON()));
                if (!geoJson.properties) {
                    geoJson.properties = {};
                }
                //debugger;
                geoJson.properties.options = JSON.parse(JSON.stringify(layer.options));
                //debugger;
                if (layer.options.radius) {
                    var radius = parseFloat(layer.options.radius);
                    if (radius % 1 !== 0) {
                        geoJson.properties.options.radius = radius.toFixed(6);
                    } else {
                        geoJson.properties.options.radius = radius.toFixed(0);
                    }
                }
                //debugger;

                if (layer instanceof L.Rectangle) {
                    geoJson.properties.type = "rectangle";
                } else if (layer instanceof L.Circle) {
                    geoJson.properties.type = "circle";
                } else if (layer instanceof L.CircleMarker) {
                    geoJson.properties.type = "circlemarker";
                } else if (layer instanceof L.Polygon) {
                    geoJson.properties.type = "polygon";
                } else if (layer instanceof L.Polyline) {
                    geoJson.properties.type = "polyline";
                } else if (layer instanceof L.Marker) {
                    geoJson.properties.type = "marker";
                }

                geo.features.push(geoJson);
            });
            //debugger;
            //console.log(JSON.stringify(geo));
            //alert(JSON.stringify(geo))
            return geo
        }


        function findLayers(map) {
            var layers = [];
            map.eachLayer(layer => {
                if (
                    layer instanceof L.Polyline ||
                    layer instanceof L.Marker ||
                    layer instanceof L.Circle ||
                    layer instanceof L.CircleMarker
                ) {
                    layers.push(layer);
                }
            });
            //debugger;
            // filter out layers that don't have the leaflet-geoman instance
            layers = layers.filter(layer => layer.pm);
            //debugger;
            // filter out everything that's leaflet-geoman specific temporary stuff
            //layers = layers.filter(layer => !layer._pmTempLayer);
            layers = layers.filter(layer => layer._drawnByGeoman);
            //debugger;
            return layers;
        }


        function importGeo() {
            var prom = prompt();
            if (prom) {
                importGeoJSON(JSON.parse(prom));
            }
        }

        function importGeoJSON(feature) {
            var geoLayer = L.geoJSON(feature, {
                style: function (feature) {
                    return feature.properties.options;
                },
                pointToLayer: function (feature, latlng) {
                    switch (feature.properties.type) {
                        case "marker": return new L.Marker(latlng);
                        case "circle": return new L.Circle(latlng, feature.properties.options);
                        case "circlemarker": return new L.CircleMarker(latlng, feature.properties.options);
                    }
                }
            });

            geoLayer.getLayers().forEach((layer) => {
                if (layer._latlng) {
                    var latlng = layer.getLatLng();
                } else {
                    var latlng = layer.getLatLngs();
                }
                switch (layer.feature.properties.type) {
                    case "rectangle":
                        new L.Rectangle(latlng, layer.options).addTo(map);
                        break;
                    case "circle":
                        console.log(layer.options)
                        new L.Circle(latlng, layer.options).addTo(map);
                        break;
                    case "polygon":
                        new L.Polygon(latlng, layer.options).addTo(map);
                        break;
                    case "polyline":
                        new L.Polyline(latlng, layer.options).addTo(map);
                        break;
                    case "marker":
                        if (layer.feature.properties.options.textMarker) {
                            new L.Marker(latlng, {
                                textMarker: true,
                                text: layer.feature.properties.options.text,
                            }).addTo(map)
                        } else {
                            new L.Marker(latlng, layer.options).addTo(map);
                        }
                        break;
                    case "circlemarker":
                        new L.CircleMarker(latlng, layer.options).addTo(map);
                        break;
                }
            })
        }

        // style editor plugin
        var styleEditor = L.control.styleEditor({
            position: "bottomright"
        });
        map.addControl(styleEditor);

        //export drawing objects
        function downloadObjectAsJson(exportObj, exportName) {
            let nodata = '{"type":"FeatureCollection","features":[]}';
            var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportObj));
            let datenow = new Date();
            let datenowstr = datenow.toLocaleDateString('pt-BR');
            var downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", exportName + datenowstr + ".geojson");
            document.body.appendChild(downloadAnchorNode); // required for firefox
            debugger;
            if (JSON.stringify(exportObj) == nodata) {
                alert('No features are drawn');
            } else {
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            }
        }
        var button_exp = document.getElementById('export');
        button_exp.addEventListener('click', () => downloadObjectAsJson(generateGeoJson(), "arquivo_"));

        // Read input file
        var button_imp = document.getElementById('import');
        /*button_imp.addEventListener('change', function (event) {
            var file = button_imp.files[0],
                fr = new FileReader();
            button_imp.value = ''; // Clear the input.
            debugger;
            fr.onload = console.log(fr.result);
            debugger;
            fr.onload = importGeoJSON(fr.result);
        })*/

        //const changeStatus = (status) => {
        //    document.getElementById('status').innerHTML = status;
        //}
        /*const setProgress = (e) => {
            const fr = e.target;
            const loadingPercentage = 100 * e.loaded / e.total;

            document.getElementById('progress-bar').value = loadingPercentage;
        }*/
        const loaded = (e) => {
            const fr = e.target;
            var result = fr.result;

            //changeStatus('Finished Loading!');
            console.log('Result:', result);
            //reading drawing objects
            importGeoJSON(JSON.parse(result));
        }
        //const errorHandler = (e) => {
        //    changeStatus('Error: ' + e.target.error.name);
        //}
        const processFile = (file) => {
            const fr = new FileReader();

            //fr.readAsDataURL(file);
            fr.readAsText(file)
            //fr.addEventListener('loadstart', changeStatus('Start Loading'));
            //fr.addEventListener('load', changeStatus('Loaded'));
            fr.addEventListener('loadend', loaded);
            //fr.addEventListener('progress', setProgress);
            //fr.addEventListener('error', errorHandler);
            //fr.addEventListener('abort', changeStatus('Interrupted'));
        }

        document.getElementById('import').addEventListener('change', (e) => {
            const file = document.getElementById('import').files[0];

            if (file) {
                processFile(file);
            }
        });



        // print plugin
        var customActionToPrint = function (context, mode) {
            return function () {
                window.alert("We are printing the MAP. Let's do Custom print here!");
                context._printMode(mode);
            }
        };

        L.control.browserPrint({
            title: 'Print Map',
            //documentTitle: 'Map printed using leaflet.browser.print plugin',

            closePopupsOnPrint: false,
            printModes: [
                L.BrowserPrint.Mode.Landscape("Tabloid", { title: "Tabloid VIEW" }),
                L.browserPrint.mode("Alert", { title: "User specified print action", pageSize: "A4", action: customActionToPrint, invalidateBounds: false }),
                L.BrowserPrint.Mode.Landscape(),
                "Portrait",
                L.BrowserPrint.Mode.Auto("A4", { title: "Auto" }),
                L.BrowserPrint.Mode.Custom("A4", { title: "Select area" })
            ],
            manualMode: false
        }).addTo(map);



    </script>
</body>

</html>